input {
  tcp {
    port => 50000
    codec => json_lines
  }
}

filter {
  # 1. Date Filter: Fix the timestamp
  # We want the time the event happened, not the time Logstash received it.
  date {
    match => [ "time", "ISO8601", "yyyy-MM-dd'T'HH:mm:ss.SSS'Z'" ]
    target => "@timestamp"
    remove_field => [ "time" ] # Clean up the duplicate field
  }

  # 2. Add Metadata (Optional but helpful)
  mutate {
    add_field => { "environment" => "development" }
  }
}

output {
  elasticsearch {
    hosts => ["http://elasticsearch:9200"]
    index => "logs-%{+YYYY.MM.dd}"
    # user => "elastic"  <-- Uncomment this later when you add security
    # password => "changeme"
  }

  # stdout { 7yed comment lhada ila biti pc itfrge3
  #   codec => rubydebug
  # }
}